<!--  This site was created in Webflow. http://www.webflow.com -->
<!DOCTYPE html>
<!--  Last Published: Sun Apr 16 2017 18:02:35 GMT+0000 (UTC)  -->
<html data-wf-page="58f34a281be878187a80b0f4" data-wf-site="58f34a281be878187a80b0f3">

<head>
    <meta charset="utf-8">
    <title>wiproject</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    <link href="css/normalize.css" rel="stylesheet" type="text/css">
    <link href="css/webflow.css" rel="stylesheet" type="text/css">
    <link href="css/wiproject.webflow.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
    <script type="text/javascript">
        WebFont.load({
            google: {
                families: ["Ubuntu:300,300italic,400,400italic,500,500italic,700,700italic", "Roboto:100,300,regular,500,700,900,900italic"]
            }
        });
    </script>
    <script src="js/modernizr.js" type="text/javascript"></script>
    <link href="https://daks2k3a4ib2z.cloudfront.net/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png" rel="apple-touch-icon">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" type="text/css" href="css/notyf.min.css">

</head>

<body class="body">
    <div class="topbar">
        <div class="w-row">
            <div class="w-col w-col-4"></div>
            <div class="w-col w-col-4">
                <div class="text-block">WI-SUN DEMO</div>
            </div>
            <div class="w-col w-col-4">
                <div class="text-block-10" id="date">1</div>
            </div>
        </div>
        <div id="mapdiv" style="width:100%;height:1300px;">
        </div>
    </div>

    <div class="bottombar">
        <div class="w-row">
            <div class="column w-col w-col-5" id="infocolumn">
                <div class="text-block-7">INFORMATION</div>
                <div class="w-row">
                    <div class="w-clearfix w-col w-col-2">
                        <div class="div-block-3">alpha v0.0.1
                        </div>
                    </div>
                    <div class="w-col w-col-10">
                        <div class="div-block-2">
                            <div class="w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">CASE NO</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infocaseno"></div>
                                </div>
                            </div>
                            <div class="w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">ID</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infoalarmid"></div>
                                </div>
                            </div>
                            <div class="row w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">NAME</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infoname"></div>
                                </div>
                            </div>
                            <div class="row w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">ADDRESS</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infoaddress"></div>
                                </div>
                            </div>
                            <div class="w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">PROPERTY</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infoproptype"></div>
                                </div>
                            </div>
                            <div class="w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">CONTACT</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infocontact"></div>
                                </div>
                            </div>
                            <div class="w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">STATUS</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infostatus"></div>
                                </div>
                            </div>
                            <div class="w-row">
                                <div class="w-clearfix w-col w-col-2">
                                    <div class="text-block-5">UPDATED</div>
                                </div>
                                <div class="w-col w-col-10">
                                    <div class="text-block-6" id="infoupdated"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column-2 w-col w-col-7">
                <div class="row-2 w-row">
                    <div class="w-col w-col-1"></div>
                    <div class="w-col w-col-2"></div>
                    <div class="w-col w-col-1"></div>
                    <div class="w-col w-col-5">
                        <div class="text-block-7" onclick="resetUI();">CASES</div>
                    </div>
                    <div class="w-col w-col-2"></div>
                    <div class="w-col w-col-1"></div>
                </div>
                <div class="div-block-4">
                    <div class="row-2 w-row">
                        <div class="w-col w-col-1">
                            <div class="text-block-9">NO</div>
                        </div>
                        <div class="w-col w-col-2">
                            <div class="text-block-9">TIME LODGED</div>
                        </div>
                        <div class="w-col w-col-1">
                            <div class="text-block-9">TYPE</div>
                        </div>
                        <div class="w-col w-col-5">
                            <div class="text-block-9">ADDRESS</div>
                        </div>
                        <div class="w-col w-col-2">
                            <div class="text-block-9">LAST UPDATED</div>
                        </div>
                        <div class="w-col w-col-1">
                            <div class="text-block-9">STATUS</div>
                        </div>
                    </div>
                    <div class="row-2 w-row" id="caseblock">

                    </div>

                </div>
            </div>
        </div>
    </div>
    <template class="row-2 w-row" id="cases-template">
      <div class="row-2 w-row" id="caseborder" onclick="displayInfoFromTabs(this);">
        <div class="w-col w-col-1">
          <div class="text-block-8" id="caseno"></div>
        </div>
        <div class="w-col w-col-2">
          <div class="text-block-8" id="caselodged"></div>
        </div>
        <div class="w-col w-col-1">
          <div class="text-block-8" id="caseproptype"></div>
        </div>
        <div class="w-col w-col-5">
          <div class="text-block-8" id="caseaddress"></div>
        </div>
        <div class="w-col w-col-2">
          <div class="text-block-8" id="caseupdated"></div>
        </div>
        <div class="w-col w-col-1">
          <div class="text-block-8" id="casestatus"></div>
        </div>
      </div>
    </template>
    <!--
    <script src="js/notyf.min.js" type="text/javascript"></script>
  -->
    <script>
        var socket = io.connect();
        var case_list = [];
        var map;
        var mapSettings;
        var displayed_case = null;
        var notyf = new Notyf({
            delay:10000,
        })
        var has_loaded = false;
        setInterval(function() {
            var date = new Date();
            document.getElementById("date").innerHTML = date;
        }, 500);
        socket.on('case_list', function(data) {
            if(!has_loaded)
            {
                has_loaded = true;
                for (var i = 0; i < data.length; i++) {
                    addNewCase(data[i]);
                }
            }
        });
        socket.on('new_case', function(data) {
            //emit callback from server
            resetUI();
            addNewCase(data);
        });
        socket.on('update_case', function(data) {
            //emit callback from server
            updateCase(data);
        });
        function addNewCase(fire_case) {
            playBeep();
            notyf.alert("Fire Alert! Case No: " + fire_case.case_no);
            case_list.push(fire_case);
            var caseblock = document.getElementById('caseblock');
            var tmpl = document.getElementById('cases-template').content.cloneNode(true);
            var full_address = fire_case.address + " , " + fire_case.unitno + " , " + fire_case.postalcode;
            tmpl.querySelector('#caseno').innerHTML = fire_case.case_no;
            tmpl.querySelector('#caselodged').innerHTML = fire_case.time_lodged;
            tmpl.querySelector('#caseproptype').innerHTML = fire_case.type;
            tmpl.querySelector('#caseaddress').innerHTML = full_address;
            tmpl.querySelector('#caseupdated').innerHTML = fire_case.last_update;
            tmpl.querySelector('#casestatus').innerHTML = fire_case.status;
            caseblock.insertBefore(tmpl, caseblock.firstChild);
            addMarker(parseFloat(fire_case.lat), parseFloat(fire_case.lng), String(fire_case.case_no));
        }
        function updateCase(fire_case) {
            playBeep();
            case_list[fire_case.case_no].status = fire_case.status;
            case_list[fire_case.case_no].last_update = fire_case.last_update;
            //update the info tab if it's active
            if (displayed_case == fire_case.case_no) {
                document.getElementById("infostatus").innerHTML = fire_case.status;
                document.getElementById("infoupdated").innerHTML = fire_case.last_update;
            }
            //find the correct div from template based on case no.
            //index is inversed as the template is prepended
            var case_div = document.querySelectorAll('#caseborder')[(case_list.length - 1) - fire_case.case_no];
            case_div.querySelector('#casestatus').innerHTML = fire_case.status;
            case_div.querySelector('#caseupdated').innerHTML = fire_case.last_update;
        }
        function addMarker(lat, lng, case_no) {
            var location = {
                lat: lat,
                lng: lng
            }
            var marker = new google.maps.Marker({
                position: location,
                title: case_no,
                label: case_no,
                animation: google.maps.Animation.DROP
            });
            marker.setMap(map);
            marker.addListener('click', function() {
                displayInfo(case_list[parseInt(marker.label)]);
            });
        }
        function zoomMap(location, zoom) {
            map.setZoom(zoom);
            map.setCenter(location);
        }
        function initMap() {
            mapSettings = {
                center: new google.maps.LatLng(1.262243, 103.830490),
                zoom: 12,
                styles: [
                    {
                        "stylers": [{"hue": "#ff1a00"},
                            {"invert_lightness": true},
                            {"saturation": -100},
                            {"lightness": 33},
                            {"gamma": 0.5}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers":
                        [{"color": "#2D333C"}]
                    }
                ]
            };
            map = new google.maps.Map(document.getElementById("mapdiv"), mapSettings);
        }
        function displayInfo(fire_case) {
            displayed_case = fire_case.case_no;
            var full_address = fire_case.address + " , " + fire_case.unitno + " , " + fire_case.postalcode;
            document.getElementById("infoname").innerHTML = fire_case.name;
            document.getElementById("infoaddress").innerHTML = full_address;
            document.getElementById("infoproptype").innerHTML = fire_case.type;
            document.getElementById("infocontact").innerHTML = fire_case.contact;
            document.getElementById("infostatus").innerHTML = fire_case.status;
            document.getElementById("infocaseno").innerHTML = fire_case.case_no;
            document.getElementById("infoalarmid").innerHTML = fire_case.id;
            document.getElementById("infoupdated").innerHTML = fire_case.last_update;
            var zoom_position = {
                lat: fire_case.lat - 0.0015,
                lng: fire_case.lng
            }
            zoomMap(zoom_position, 18);
        }
        function displayInfoFromTabs(case_no) {
            case_index = parseInt(case_no.querySelector('#caseno').innerHTML);
            displayInfo(case_list[case_index]);
        }
        function resetUI() {
            var zoom_position = {
                lat: 1.262243,
                lng: 103.830490
            };
            zoomMap(zoom_position, 12);
            document.getElementById("infoname").innerHTML = "";
            document.getElementById("infoaddress").innerHTML = "";
            document.getElementById("infoproptype").innerHTML = "";
            document.getElementById("infocontact").innerHTML = "";
            document.getElementById("infostatus").innerHTML = "";
            document.getElementById("infocaseno").innerHTML = "";
            document.getElementById("infoalarmid").innerHTML = "";
            document.getElementById("infoupdated").innerHTML = "";
            displayed_case = null;
        }
        function playBeep(){
           	var audio = new Audio('mp3/beep.mp3');
	        	audio.play();
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1VvEzs3SBFzaUf_Y_ac4fKEsl5qHOXBA&callback=initMap"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script>
    <script src="js/webflow.js" type="text/javascript"></script>
</body>

</html>
